<!DOCTYPE html>
<html lang="zh-TW">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Dukshot - æˆªåœ–</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI",
          "Noto Sans TC", sans-serif;
        cursor: crosshair;
        overflow: hidden;
        background: rgba(0, 0, 0, 0.3);
        user-select: none;
      }

      #captureCanvas {
        position: absolute;
        top: 0;
        left: 0;
        cursor: crosshair;
      }

      #maskCanvas {
        position: absolute;
        top: 0;
        left: 0;
        pointer-events: none;
        z-index: 998;
      }

      .selection-rect {
        position: absolute;
        border: 2px solid #0066ff;
        background: transparent;
        pointer-events: none;
        z-index: 1000;
      }

      .selection-info {
        position: absolute;
        background: rgba(0, 0, 0, 0.8);
        color: white;
        padding: 4px 8px;
        border-radius: 4px;
        font-size: 12px;
        font-family: "Consolas", monospace;
        z-index: 1001;
        pointer-events: none;
      }

      .capture-toolbar {
        position: absolute;
        background: rgba(255, 255, 255, 0.95);
        border-radius: 8px;
        padding: 12px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        z-index: 1002;
        display: none;
        gap: 4px;
        align-items: center;
        flex-direction: column;
      }

      .capture-toolbar .toolbar-row {
        display: flex;
        gap: 4px;
        align-items: center;
      }

      .capture-btn {
        background: #0066ff;
        color: white;
        border: none;
        border-radius: 6px;
        padding: 8px 12px;
        cursor: pointer;
        font-size: 14px;
        transition: background-color 0.2s;
      }

      .capture-btn:hover {
        background: #0052cc;
      }

      .capture-btn.cancel {
        background: #666;
      }

      .capture-btn.cancel:hover {
        background: #555;
      }

      .capture-btn.save-jpg {
        background: #28a745;
      }

      .capture-btn.save-jpg:hover {
        background: #218838;
      }

      .capture-btn.save-png {
        background: #007bff;
      }

      .capture-btn.save-png:hover {
        background: #0056b3;
      }

      .capture-btn.copy-clipboard {
        background: #6f42c1;
      }

      .capture-btn.copy-clipboard:hover {
        background: #5a359a;
      }

      .capture-btn.upload {
        background: #fd7e14;
      }

      .capture-btn.upload:hover {
        background: #e8680e;
      }

      .help-text {
        position: absolute;
        top: 20px;
        left: 50%;
        transform: translateX(-50%);
        background: rgba(0, 0, 0, 0.8);
        color: white;
        padding: 12px 20px;
        border-radius: 8px;
        font-size: 14px;
        z-index: 1003;
        text-align: center;
      }

      /* é®ç½©å±¤æ¨£å¼ */
      .mask-overlay {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.7); /* åŠ æ·±é®ç½©æš—åº¦ 0.4 -> 0.7 */
        z-index: 999;
        display: none;
        pointer-events: none;
      }

      .mask-overlay.active {
        display: block;
      }

      /* é¸å–å€åŸŸæŒ–æ´çš„æ´ */
      .mask-overlay::before {
        content: '';
        position: absolute;
        background: transparent;
        border: 2px solid rgba(255, 255, 255, 0.8);
        box-shadow: 0 0 0 1px rgba(255, 255, 255, 0.3);
      }

      /* æ ¼ç·šè¦†å±¤æ¨£å¼ */
      .grid-overlay {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: 1000;
        display: none;
        pointer-events: none;
      }

      .grid-overlay.active {
        display: block;
      }

      .grid-lines {
        position: absolute;
        background: repeating-linear-gradient(
          to right,
          transparent,
          transparent 19px,
          rgba(255, 255, 255, 0.3) 20px
        );
      }

      .grid-lines.vertical {
        width: 100%;
        height: 1px;
      }

      .grid-lines.horizontal {
        width: 1px;
        height: 100%;
        background: repeating-linear-gradient(
          to bottom,
          transparent,
          transparent 19px,
          rgba(255, 255, 255, 0.3) 20px
        );
      }

      /* åº§æ¨™é¡¯ç¤ºæ¨£å¼ */
      .coordinate-display {
        position: fixed;
        bottom: 20px;
        right: 20px;
        background: rgba(0, 0, 0, 0.8);
        color: white;
        padding: 8px 12px;
        border-radius: 6px;
        font-size: 14px;
        font-family: "Consolas", monospace;
        z-index: 1004;
        pointer-events: none;
        display: none;
      }

      .coordinate-display.active {
        display: block;
      }
    </style>
  </head>
  <body>
    <div class="help-text">æŒ‰ä½æ»‘é¼ å·¦éµä¸¦æ‹–æ‹½é¸æ“‡æˆªåœ–å€åŸŸï¼ŒæŒ‰ ESC å–æ¶ˆæˆªåœ–ï¼Œå³éµé‡æ–°æŠ“å–æˆ–å†æ¬¡å–æ¶ˆ</div>

    <canvas id="captureCanvas"></canvas>
    <canvas id="maskCanvas"></canvas>
    <div class="selection-rect" id="selectionRect"></div>
    <div class="selection-info" id="selectionInfo"></div>

    <!-- é®ç½©å±¤ -->
    <div class="mask-overlay" id="maskOverlay"></div>

    <!-- æ ¼ç·šè¦†å±¤ -->
    <div class="grid-overlay" id="gridOverlay">
      <div class="grid-lines vertical" id="verticalGrid"></div>
      <div class="grid-lines horizontal" id="horizontalGrid"></div>
    </div>

    <div class="capture-toolbar" id="captureToolbar">
      <div class="toolbar-row">
        <button class="capture-btn save-jpg" id="saveJpgBtn" title="å„²å­˜ç‚º JPG">âœ… JPG</button>
        <button class="capture-btn save-png" id="savePngBtn" title="å„²å­˜ç‚º PNG">ğŸ–¼ï¸ PNG</button>
      </div>
      <div class="toolbar-row">
        <button class="capture-btn copy-clipboard" id="copyBtn" title="è¤‡è£½åˆ°å‰ªè²¼ç°¿">ğŸ“‹ è¤‡è£½</button>
        <button class="capture-btn upload" id="uploadBtn" title="ä¸Šå‚³åˆ° duk.tw (é–‹ç™¼ä¸­)">â˜ï¸ ä¸Šå‚³</button>
      </div>
      <div class="toolbar-row">
        <button class="capture-btn cancel" id="cancelBtn" title="å–æ¶ˆæˆªåœ–">âŒ å–æ¶ˆ</button>
      </div>
    <!-- åº§æ¨™é¡¯ç¤ºå€åŸŸ -->
    <div class="coordinate-display" id="coordinateDisplay"></div>
    </div>

    <script>
      class CaptureScreen {
        constructor() {
          console.log('CaptureScreen: åˆå§‹åŒ–é–‹å§‹');
          this.canvas = document.getElementById("captureCanvas");
          this.ctx = this.canvas.getContext("2d");
          this.maskCanvas = document.getElementById("maskCanvas");
          this.maskCtx = this.maskCanvas.getContext("2d");
          this.isSelecting = false;
          this.startX = 0;
          this.startY = 0;
          this.currentX = 0;
          this.currentY = 0;
          this.selectedRegion = null;
          this.hasRecaptured = false; // è¿½è¹¤æ˜¯å¦å·²ç¶“é‡æ–°æŠ“å–é

          // é®ç½©å’Œæ ¼ç·šå…ƒç´ 
          this.maskOverlay = document.getElementById("maskOverlay");
          this.gridOverlay = document.getElementById("gridOverlay");
          // åº§æ¨™é¡¯ç¤ºå…ƒç´ 
          this.coordinateDisplay = document.getElementById("coordinateDisplay");

          this.init();
        }

        async init() {
          // è¨­å®šç•«å¸ƒå¤§å°ç‚ºè¢å¹•å¤§å°
          this.canvas.width = window.screen.width;
          this.canvas.height = window.screen.height;
          this.maskCanvas.width = window.screen.width;
          this.maskCanvas.height = window.screen.height;

          console.log('CaptureScreen: ç•«å¸ƒè¨­å®šå®Œæˆ', this.canvas.width, 'x', this.canvas.height);

          // è¨­å®šäº‹ä»¶ç›£è½å™¨ï¼ˆå…ˆè¨­å®šï¼Œä»¥ä¾¿æ¥æ”¶è¢å¹•æ•¸æ“šï¼‰
          this.setupEventListeners();

          // ç›£è½è¢å¹•æ•¸æ“š
          this.listenForScreenData();
        }

        listenForScreenData() {
          console.log('CaptureScreen: ç­‰å¾…è¢å¹•æ•¸æ“š...');
          
          // ç›£è½å¾ä¸»é€²ç¨‹å‚³ä¾†çš„è¢å¹•æ•¸æ“š
          window.electronAPI.onScreenData((screenData) => {
            console.log('CaptureScreen: æ¥æ”¶åˆ°è¢å¹•æ•¸æ“š');
            this.loadScreenImage(screenData);
          });
        }
        
        loadScreenImage(screenData) {
          const img = new Image();
          img.onload = () => {
            console.log('CaptureScreen: ç¹ªè£½èƒŒæ™¯åœ–ç‰‡');
            this.ctx.drawImage(
              img,
              0,
              0,
              this.canvas.width,
              this.canvas.height
            );
            // é‡ç½®é‡æ–°æŠ“å–ç‹€æ…‹
            this.hasRecaptured = false;
            
            // è¼‰å…¥å®Œæˆå¾Œç«‹å³é¡¯ç¤ºåˆå§‹æš—åŒ–é®ç½©
            this.showInitialMask();
          };
          img.onerror = (error) => {
            console.error('CaptureScreen: è¼‰å…¥åœ–ç‰‡å¤±æ•—', error);
          };
          img.src = screenData;
        }
        
        // é¡¯ç¤ºåˆå§‹æš—åŒ–é®ç½©
        showInitialMask() {
          // ä½¿ç”¨ Canvas ç¹ªè£½å…¨è¢å¹•æš—åŒ–é®ç½©
          this.maskCtx.fillStyle = 'rgba(0, 0, 0, 0.7)';
          this.maskCtx.fillRect(0, 0, this.maskCanvas.width, this.maskCanvas.height);
        }

        // ç¹ªè£½å»¶ä¼¸ç·šï¼ˆè¼”åŠ©ç·šï¼‰
        drawExtensionLines(x, y, width, height) {
          this.maskCtx.save();

          // è¨­å®šå»¶ä¼¸ç·šæ¨£å¼
          this.maskCtx.strokeStyle = 'rgba(255, 255, 255, 0.3)';
          this.maskCtx.lineWidth = 1;
          this.maskCtx.setLineDash([5, 5]);

          // é–‹å§‹ç¹ªè£½è·¯å¾‘
          this.maskCtx.beginPath();

          // ä¸Šé‚Šå»¶ä¼¸ç·šï¼šå¾é¸å€ä¸Šé‚Šå»¶ä¼¸åˆ°é ‚éƒ¨å’Œåº•éƒ¨
          this.maskCtx.moveTo(x, 0);
          this.maskCtx.lineTo(x, y);
          this.maskCtx.moveTo(x + width, 0);
          this.maskCtx.lineTo(x + width, y);

          // ä¸‹é‚Šå»¶ä¼¸ç·šï¼šå¾é¸å€ä¸‹é‚Šå»¶ä¼¸åˆ°é ‚éƒ¨å’Œåº•éƒ¨
          this.maskCtx.moveTo(x, y + height);
          this.maskCtx.lineTo(x, this.maskCanvas.height);
          this.maskCtx.moveTo(x + width, y + height);
          this.maskCtx.lineTo(x + width, this.maskCanvas.height);

          // å·¦é‚Šå»¶ä¼¸ç·šï¼šå¾é¸å€å·¦é‚Šå»¶ä¼¸åˆ°å·¦å³é‚Šç·£
          this.maskCtx.moveTo(0, y);
          this.maskCtx.lineTo(x, y);
          this.maskCtx.moveTo(x + width, y);
          this.maskCtx.lineTo(this.maskCanvas.width, y);

          // å³é‚Šå»¶ä¼¸ç·šï¼šå¾é¸å€å³é‚Šå»¶ä¼¸åˆ°å·¦å³é‚Šç·£
          this.maskCtx.moveTo(0, y + height);
          this.maskCtx.lineTo(x, y + height);
          this.maskCtx.moveTo(x + width, y + height);
          this.maskCtx.lineTo(this.maskCanvas.width, y + height);

          // ç¹ªè£½æ‰€æœ‰å»¶ä¼¸ç·š
          this.maskCtx.stroke();

          this.maskCtx.restore();
        }

        // ç¹ªè£½é¸å€é®ç½©
        // ç¹ªè£½é¸å€é®ç½©
        drawMask(x, y, width, height) {
          // æ¸…é™¤ç•«å¸ƒ
          this.maskCtx.clearRect(0, 0, this.maskCanvas.width, this.maskCanvas.height);

          // ç¹ªè£½å…¨è¢å¹•æš—åŒ–é®ç½©
          this.maskCtx.fillStyle = 'rgba(0, 0, 0, 0.7)';
          this.maskCtx.fillRect(0, 0, this.maskCanvas.width, this.maskCanvas.height);

          // ä½¿ç”¨ destination-out æ¨¡å¼æ¸…é™¤é¸å€å…§çš„é®ç½©ï¼ˆæŒ–æ´æ•ˆæœï¼‰
          this.maskCtx.globalCompositeOperation = 'destination-out';
          this.maskCtx.fillRect(x, y, width, height);

          // é‡ç½®æ··åˆæ¨¡å¼
          // é‡ç½®æ··åˆæ¨¡å¼
          this.maskCtx.globalCompositeOperation = 'source-over';

          // ç¹ªè£½å»¶ä¼¸ç·š
          this.drawExtensionLines(x, y, width, height);
          this.maskCtx.globalCompositeOperation = 'source-over';
        }

        async captureScreen() {
          try {
            console.log('CaptureScreen: é‡æ–°æŠ“å–è¢å¹•æˆªåœ–');
            
            // é‡æ–°ç²å–è¢å¹•æº
            const sources = await window.electronAPI.getDesktopSources();
            if (sources.length > 0) {
              this.loadScreenImage(sources[0].thumbnail);
            }
          } catch (error) {
            console.error("Error capturing screen:", error);
            alert("ç„¡æ³•ç²å–è¢å¹•æˆªåœ–ï¼Œè«‹é‡è©¦");
            window.close();
          }
        }

        setupEventListeners() {
          // æ»‘é¼ äº‹ä»¶
          this.canvas.addEventListener(
            "mousedown",
            this.onMouseDown.bind(this)
          );
          this.canvas.addEventListener(
            "mousemove",
            this.onMouseMove.bind(this)
          );
          this.canvas.addEventListener("mouseup", this.onMouseUp.bind(this));

          // å³éµäº‹ä»¶
          this.canvas.addEventListener(
            "contextmenu",
            this.onContextMenu.bind(this)
          );

          // éµç›¤äº‹ä»¶
          document.addEventListener("keydown", this.onKeyDown.bind(this));

          // å·¥å…·åˆ—æŒ‰éˆ•äº‹ä»¶
          document
            .getElementById("saveJpgBtn")
            .addEventListener("click", () => this.confirmCapture("jpg"));
          document
            .getElementById("savePngBtn")
            .addEventListener("click", () => this.confirmCapture("png"));
          document
            .getElementById("copyBtn")
            .addEventListener("click", this.copyToClipboard.bind(this));
          document
            .getElementById("uploadBtn")
            .addEventListener("click", this.uploadToDukTw.bind(this));
          document
            .getElementById("cancelBtn")
            .addEventListener("click", this.cancelCapture.bind(this));
        }

        onMouseDown(event) {
          console.log('CaptureScreen: onMouseDown', event.clientX, event.clientY);

          this.isSelecting = true;
          this.startX = event.clientX;
          this.startY = event.clientY;
          this.currentX = event.clientX;
          this.currentY = event.clientY;

          // éš±è—å·¥å…·åˆ—
          document.getElementById("captureToolbar").style.display = "none";
          document.querySelector(".help-text").style.display = "none";
        }

        onMouseMove(event) {
          // æ›´æ–°åº§æ¨™é¡¯ç¤ºï¼ˆç„¡è«–æ˜¯å¦åœ¨é¸å–ï¼‰
          this.updateCoordinateDisplay(event);
          
          if (!this.isSelecting) return;

          this.currentX = event.clientX;
          this.currentY = event.clientY;

          this.updateSelection();
        }

        onMouseUp(event) {
          if (!this.isSelecting) return;

          this.isSelecting = false;

          const width = Math.abs(this.currentX - this.startX);
          const height = Math.abs(this.currentY - this.startY);

          if (width > 10 && height > 10) {
            this.selectedRegion = {
              x: Math.min(this.startX, this.currentX),
              y: Math.min(this.startY, this.currentY),
              width: width,
              height: height,
            };

            this.showToolbar();
          } else {
            this.clearSelection();
          }
          
          // æ›´æ–°åº§æ¨™é¡¯ç¤º
          this.updateCoordinateDisplay(event);
        }

        updateCoordinateDisplay(event) {
          // é¡¯ç¤ºåº§æ¨™ï¼Œé¸å–æ™‚é¡¯ç¤ºå€åŸŸè³‡è¨Š
          if (this.selectedRegion) {
            const { width, height } = this.selectedRegion;
            this.coordinateDisplay.textContent = `å€åŸŸï¼š${width} Ã— ${height}`;
          } else {
            const x = event.clientX;
            const y = event.clientY;
            this.coordinateDisplay.textContent = `åº§æ¨™ï¼š${x}, ${y}`;
          }
          this.coordinateDisplay.classList.add("active");
        }

        onKeyDown(event) {
          if (event.key === "Escape") {
            this.cancelCapture();
          } else if (event.key === "Enter" && this.selectedRegion) {
            this.confirmCapture();
          }
        }

        onContextMenu(event) {
          event.preventDefault(); // é˜²æ­¢é è¨­å³éµé¸å–®

          if (!this.hasRecaptured) {
            // ç¬¬ä¸€æ¬¡å³éµï¼šé‡æ–°æŠ“å–è¢å¹•æˆªåœ–
            this.clearSelection();
            this.captureScreen();
            this.hasRecaptured = true;
          } else {
            // ç¬¬äºŒæ¬¡å³éµï¼šå–æ¶ˆæˆªåœ–
            this.cancelCapture();
          }
        }

        updateSelection() {
          const rect = document.getElementById("selectionRect");
          const info = document.getElementById("selectionInfo");

          const x = Math.min(this.startX, this.currentX);
          const y = Math.min(this.startY, this.currentY);
          const width = Math.abs(this.currentX - this.startX);
          const height = Math.abs(this.currentY - this.startY);

          rect.style.left = x + "px";
          rect.style.top = y + "px";
          rect.style.width = width + "px";
          rect.style.height = height + "px";
          rect.style.display = "block";

          info.textContent = `${width} Ã— ${height}`;
          info.style.left = x + width + 10 + "px";
          info.style.top = y + "px";
          info.style.display = "block";

          // æ›´æ–°è¦–è¦ºæ•ˆæœ
          this.updateVisualEffects(x, y, width, height);
        }

        updateVisualEffects(x, y, width, height) {
          // å¦‚æœæ²’æœ‰é¸å–å€åŸŸï¼Œéš±è—è¦–è¦ºæ•ˆæœ
          if (width < 10 || height < 10) {
            this.hideVisualEffects();
            return;
          }

          // é¡¯ç¤ºæ ¼ç·š
          this.showGrid();

          // ä½¿ç”¨ Canvas ç¹ªè£½é¸å€é®ç½©
          this.drawMask(x, y, width, height);

          // æ›´æ–°æ ¼ç·šä½ç½® - æ ¼ç·šåªåœ¨é¸å–å€åŸŸå…§é¡¯ç¤º
          this.gridOverlay.style.left = x + 'px';
          this.gridOverlay.style.top = y + 'px';
          this.gridOverlay.style.width = width + 'px';
          this.gridOverlay.style.height = height + 'px';
        }

        showGrid() {
          this.gridOverlay.classList.add('active');
        }

        hideGrid() {
          this.gridOverlay.classList.remove('active');
        }

        showVisualEffects() {
          this.showGrid();
        }

        hideVisualEffects() {
          this.hideGrid();
          // æ¸…é™¤é®ç½© Canvas
          this.maskCtx.clearRect(0, 0, this.maskCanvas.width, this.maskCanvas.height);
        }

        showToolbar() {
          console.log('CaptureScreen: é¡¯ç¤ºæ“ä½œé¸å–®');
          const toolbar = document.getElementById("captureToolbar");
          const region = this.selectedRegion;

          // è¨ˆç®—å·¥å…·åˆ—ä½ç½®ï¼Œç¢ºä¿ä¸è¶…å‡ºè¢å¹•
          let left = region.x + region.width - 200;
          let top = region.y + region.height + 10;
          
          // é‚Šç•Œæª¢æŸ¥
          if (left < 0) left = 10;
          if (left + 200 > window.innerWidth) left = window.innerWidth - 210;
          if (top + 150 > window.innerHeight) top = region.y - 160;
          
          toolbar.style.left = left + "px";
          toolbar.style.top = top + "px";
          toolbar.style.display = "flex";
        }

        clearSelection() {
          document.getElementById("selectionRect").style.display = "none";
          document.getElementById("selectionInfo").style.display = "none";
          document.getElementById("captureToolbar").style.display = "none";
          this.selectedRegion = null;
          this.isSelecting = false;

          // éš±è—è¦–è¦ºæ•ˆæœä¸¦é¡¯ç¤ºåˆå§‹é®ç½©
          this.hideVisualEffects();
          this.showInitialMask();
        }

        async confirmCapture(format = "png") {
          if (!this.selectedRegion) return;

          try {
            // å‰µå»ºè‡¨æ™‚ç•«å¸ƒä¾†è£åˆ‡é¸ä¸­å€åŸŸ
            const tempCanvas = document.createElement("canvas");
            const tempCtx = tempCanvas.getContext("2d");

            tempCanvas.width = this.selectedRegion.width;
            tempCanvas.height = this.selectedRegion.height;

            // è£åˆ‡é¸ä¸­å€åŸŸ
            tempCtx.drawImage(
              this.canvas,
              this.selectedRegion.x,
              this.selectedRegion.y,
              this.selectedRegion.width,
              this.selectedRegion.height,
              0,
              0,
              this.selectedRegion.width,
              this.selectedRegion.height
            );

            // å°‡åœ–ç‰‡æ•¸æ“šç™¼é€åˆ°ä¸»é€²ç¨‹
            const mimeType = format === "jpg" ? "image/jpeg" : "image/png";
            const imageData = tempCanvas.toDataURL(mimeType);
            const result = await window.electronAPI.saveScreenshot(
              imageData,
              format
            );

            if (result.success) {
              // é—œé–‰æˆªåœ–è¦–çª—
              window.close();
            } else {
              alert("å„²å­˜æˆªåœ–å¤±æ•—: " + (result.error || "æœªçŸ¥éŒ¯èª¤"));
            }
          } catch (error) {
            console.error("Error confirming capture:", error);
            alert("æˆªåœ–è™•ç†å¤±æ•—: " + error.message);
          }
        }

        async copyToClipboard() {
          if (!this.selectedRegion) return;

          try {
            // å‰µå»ºè‡¨æ™‚ç•«å¸ƒä¾†è£åˆ‡é¸ä¸­å€åŸŸ
            const tempCanvas = document.createElement("canvas");
            const tempCtx = tempCanvas.getContext("2d");

            tempCanvas.width = this.selectedRegion.width;
            tempCanvas.height = this.selectedRegion.height;

            // è£åˆ‡é¸ä¸­å€åŸŸ
            tempCtx.drawImage(
              this.canvas,
              this.selectedRegion.x,
              this.selectedRegion.y,
              this.selectedRegion.width,
              this.selectedRegion.height,
              0,
              0,
              this.selectedRegion.width,
              this.selectedRegion.height
            );

            // å°‡åœ–ç‰‡è½‰æ›ç‚º blob
            tempCanvas.toBlob(async (blob) => {
              try {
                await navigator.clipboard.write([
                  new ClipboardItem({ [blob.type]: blob })
                ]);
                // é—œé–‰æˆªåœ–è¦–çª—
                window.close();
              } catch (error) {
                console.error("Error copying to clipboard:", error);
                alert("è¤‡è£½åˆ°å‰ªè²¼ç°¿å¤±æ•—: " + error.message);
              }
            });
          } catch (error) {
            console.error("Error processing image for clipboard:", error);
            alert("åœ–ç‰‡è™•ç†å¤±æ•—: " + error.message);
          }
        }

        uploadToDukTw() {
          // æš«æ™‚é¡¯ç¤ºé–‹ç™¼ä¸­æç¤º
          alert("ä¸Šå‚³åˆ° duk.tw åŠŸèƒ½é–‹ç™¼ä¸­ï¼Œæ•¬è«‹æœŸå¾…ï¼");
        }

        cancelCapture() {
          window.close();
        }
      }

      // åˆå§‹åŒ–æˆªåœ–åŠŸèƒ½
      document.addEventListener("DOMContentLoaded", () => {
        new CaptureScreen();
      });
    </script>
  </body>
</html>
